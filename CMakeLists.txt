cmake_minimum_required(VERSION 3.9)
project(P11_Mail_Server)

set(CMAKE_CXX_STANDARD 20)

include_directories(lib/openssl/include/)
include_directories(lib/jwt-cpp/include/)
include_directories(lib/udns/)

include_directories(/usr/include/)
include_directories(/usr/local/include/)
include_directories(/usr/local/include/mysql/)
include_directories(/usr/local/include/mysql++/)
include_directories(/usr/local/ssl)

find_package(OpenSSL REQUIRED)

include_directories(src)

set(SOURCE_FILES main.cpp lib/udns/udns.h src/general/socket.cpp src/http/http_request_carrier.cpp src/http/http_request_carrier.h src/tasks/task.h src/tasks/http/server/reception_task.cpp src/tasks/http/server/reception_task.h src/general/state.h src/general/connection.cpp src/general/connection.h src/tasks/http/server/initialize_server_task.cpp src/tasks/http/server/initialize_server_task.h src/tasks/http/server/receive_requests_task.cpp src/tasks/http/server/receive_requests_task.h src/tasks/http/server/prune_connections_task.cpp src/tasks/http/server/prune_connections_task.h src/general/task_scheduler.cpp src/general/task_scheduler.h src/general/client_request.cpp src/general/client_request.h src/http/http_request_envelope.h src/tasks/http/server/process_http_requests_task.cpp src/tasks/http/server/process_http_requests_task.h src/tasks/http/server/initialize_client_requests_task.cpp src/tasks/http/server/initialize_client_requests_task.h src/tasks/http/server/load_requested_file_task.cpp src/tasks/http/server/load_requested_file_task.h src/tasks/http/server/finalize_client_requests_task.cpp src/tasks/http/server/finalize_client_requests_task.h src/tasks/http/server/send_responses_task.cpp src/tasks/http/server/send_responses_task.h src/general/configuration.h src/tasks/load_configuration_task.cpp src/tasks/load_configuration_task.h src/general/url.cpp src/general/url.h src/tasks/http/client/send_http_requests_task.cpp src/tasks/http/client/send_http_requests_task.h src/tasks/http/client/initialize_http_request_connections_task.cpp src/tasks/http/client/initialize_http_request_connections_task.h src/tasks/http/client/receive_http_responses_task.cpp src/tasks/http/client/receive_http_responses_task.h src/actions/action.h src/controllers/controller.h src/controllers/direct_controller.cpp src/controllers/direct_controller.h src/receivers/receiver.h src/receivers/state_action_receiver.cpp src/receivers/state_action_receiver.h src/general/identifiable.h src/general/constants.h src/objects/general/http_message.cpp src/objects/general/http_message.h src/http/http_message_parser.cpp src/http/http_message_parser.h src/applications/http_client_app.cpp src/applications/http_client_app.h src/tasks/http/client/watch_http_response_task.cpp src/tasks/http/client/watch_http_response_task.h src/applications/docker_interface_app.cpp src/applications/docker_interface_app.h src/tasks/http/server/load_routing_data_task.cpp src/tasks/http/server/load_routing_data_task.h src/objects/general/route.cpp src/objects/general/route.h src/general/route_resolver.cpp src/general/route_resolver.h src/tasks/http/server/initialize_tls_server_socket_task.cpp src/tasks/http/server/initialize_tls_server_socket_task.h src/tasks/http/server/tls_reception_task.cpp src/tasks/http/server/tls_reception_task.h src/http/http_request_reader.cpp src/http/http_request_reader.h src/objects/general/access_profile.cpp src/objects/general/access_profile.h src/objects/general/user_account.h src/objects/general/authorization.h src/tasks/http/server/authorize_user_task.cpp src/tasks/http/server/authorize_user_task.h src/objects/general/web_socket_message.h src/tasks/web_sockets/send_web_socket_messages_task.cpp src/tasks/web_sockets/send_web_socket_messages_task.h src/general/web_socket_message_generator.cpp src/general/web_socket_message_generator.h src/tasks/web_sockets/recieve_web_socket_messages_task.cpp src/tasks/web_sockets/recieve_web_socket_messages_task.h src/general/web_socket_message_parser.cpp src/general/web_socket_message_parser.h src/objects/general/session.h src/objects/general/session_record.h src/objects/general/web_socket_message_frame.h src/objects/general/web_socket_message_header.h src/objects/mail/email.h src/tasks/mail/send_email_task.cpp src/tasks/mail/send_email_task.h src/tasks/mail/resolve_mail_connection_task.cpp src/tasks/mail/resolve_mail_connection_task.h src/tasks/mail/categorize_outbound_emails_task.cpp src/tasks/mail/categorize_outbound_emails_task.h src/objects/mail/dkim_signer.cpp src/objects/mail/dkim_signer.h src/objects/mail/email.cpp src/tasks/mail/initialize_smtp_server_task.cpp src/tasks/mail/initialize_smtp_server_task.h src/tasks/mail/smtp_reception_task.cpp src/tasks/mail/smtp_reception_task.h src/tasks/mail/receive_email_task.cpp src/tasks/mail/receive_email_task.h src/objects/mail/email_parser.cpp src/objects/mail/email_parser.h src/tasks/mail/store_email_task.cpp src/tasks/mail/store_email_task.h src/objects/mail/dkim_verifier.cpp src/objects/mail/dkim_verifier.h src/objects/mail/mail_identifier.cpp src/objects/mail/mail_identifier.h src/objects/general/authenicator.cpp src/objects/general/authenicator.h src/models/account_model.h src/models/email_model.h src/tasks/database/initialize_database_connection_task.cpp src/tasks/database/initialize_database_connection_task.h src/tasks/database/load_stored_data_task.cpp src/tasks/database/load_stored_data_task.h src/state/mail_state.cpp src/state/mail_state.h src/objects/mail/email_header.cpp src/objects/mail/email_header.h src/objects/mail/header_field.h src/objects/mail/email_address.cpp src/objects/mail/email_address.h src/objects/general/tag_field.h src/objects/mail/header_field.cpp src/objects/mail/email_body.h src/objects/mail/body_part.h src/objects/mail/body_part.cpp src/models/label_model.h src/models/receive_rule.h src/models/receive_rule_labels.h src/models/email_labels.h src/tasks/controlled_task.h)
add_executable(${CMAKE_PROJECT_NAME}_run ${SOURCE_FILES})

set(SOURCE_FILES http_client.cpp src/general/socket.cpp src/http/http_request_carrier.cpp src/http/http_request_carrier.h src/tasks/task.h src/tasks/http/server/reception_task.cpp src/tasks/http/server/reception_task.h src/general/state.h src/general/connection.cpp src/general/connection.h src/tasks/http/server/initialize_server_task.cpp src/tasks/http/server/initialize_server_task.h src/tasks/http/server/receive_requests_task.cpp src/tasks/http/server/receive_requests_task.h src/tasks/http/server/prune_connections_task.cpp src/tasks/http/server/prune_connections_task.h src/general/task_scheduler.cpp src/general/task_scheduler.h src/general/client_request.cpp src/general/client_request.h src/http/http_request_envelope.h src/tasks/http/server/process_http_requests_task.cpp src/tasks/http/server/process_http_requests_task.h src/tasks/http/server/initialize_client_requests_task.cpp src/tasks/http/server/initialize_client_requests_task.h src/tasks/http/server/load_requested_file_task.cpp src/tasks/http/server/load_requested_file_task.h src/tasks/http/server/finalize_client_requests_task.cpp src/tasks/http/server/finalize_client_requests_task.h src/tasks/http/server/send_responses_task.cpp src/tasks/http/server/send_responses_task.h src/general/configuration.h src/tasks/load_configuration_task.cpp src/tasks/load_configuration_task.h src/general/url.cpp src/general/url.h src/tasks/http/client/send_http_requests_task.cpp src/tasks/http/client/send_http_requests_task.h src/tasks/http/client/initialize_http_request_connections_task.cpp src/tasks/http/client/initialize_http_request_connections_task.h src/tasks/http/client/receive_http_responses_task.cpp src/tasks/http/client/receive_http_responses_task.h src/actions/action.h src/controllers/controller.h src/controllers/direct_controller.cpp src/controllers/direct_controller.h src/receivers/receiver.h src/receivers/state_action_receiver.cpp src/receivers/state_action_receiver.h src/general/identifiable.h src/general/constants.h src/objects/general/http_message.cpp src/objects/general/http_message.h src/http/http_message_parser.cpp src/http/http_message_parser.h src/applications/http_client_app.cpp src/applications/http_client_app.h src/tasks/http/client/watch_http_response_task.cpp src/tasks/http/client/watch_http_response_task.h)
add_executable(http_client_run ${SOURCE_FILES})
add_subdirectory(src)
add_subdirectory(tests)

IF(UNIX AND NOT APPLE)
    target_link_libraries(${CMAKE_PROJECT_NAME}_run mysqlclient)
ENDIF(UNIX AND NOT APPLE)

target_link_libraries(${CMAKE_PROJECT_NAME}_run ${CMAKE_PROJECT_NAME}_lib ${CMAKE_SOURCE_DIR}/lib/udns/libudns.a)
target_link_libraries(http_client_run ${CMAKE_PROJECT_NAME}_lib)
